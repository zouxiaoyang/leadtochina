!function(a){a.fn.TcgCalendar=function(b){var c=a.extend({},a.fn.TcgCalendar.defaults,b),d=a.meta?a.extend({},c,$this.data()):c,e=this;return e.containerId="",e.weekDayNames=["Su","Mo","Tu","We","Th","Fr","Sa"],e.monthName=["January","February","March","April","May ","June","July","August","September","October","November","December"],e.monthsName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],""==d.currentDate?(new Date).toDateString():d.currentDate,dateLinkMappings=[],e.minDate=d.minDate,e.calendars=d.calendars,a.extend(this,{render:function(){a(".ui-datepicker").length>0?e.container=a(".ui-datepicker"):(e.container=a('<div class="ui-datepicker ui-widget ui-widget-content ui-corner-all"></div>'),e.container.appendTo(a("body"))),d.date||(d.date=new Date),e.startDate=d.date,a(e).bind(d.eventName,e.show)},_initCalendar:function(a){var b,c,f;for(e.startDate=a,b=[],c=e.startDate.getFullYear(),f=e.startDate.getMonth(),e.container.empty(),e.container.removeClass("ui-datepicker-multi").removeClass("ui-datepicker-multi-2").removeClass("ui-datepicker-multi-3"),e.calendars>1&&e.container.addClass(" ui-datepicker-multi ui-datepicker-multi-"+e.calendars),e.container.css("width",d.width*e.calendars+"em"),e.container.addClass(d.css),j=0;j<e.calendars;j++)b.push(e._initCalendarTable(new Date(c,f,1),j+1)),11==f?(c++,f=0):f++;b.push('<div class="ui-datepicker-row-break"></div>'),e.container.append(b.join("")),e._InitEvent()},_initCalendarTable:function(a,b){var c=[],d=a.getMonth(),f=a.getFullYear();return c.push('<div class="ui-datepicker-group ui-datepicker-group-first">'),c.push('<div class="ui-datepicker-header  ui-widget-header'),1==b?(c.push((1==e.calendars?" ui-corner-all":" ui-corner-left")+'">'),c.push('<a title="Prev" class="ui-datepicker-prev ui-corner-all"><span class="ui-icon ui-icon-circle-triangle-w">Prev</span></a>'),1==e.calendars&&c.push('<a title="Next" data-event="click" data-handler="next" class="ui-datepicker-next ui-corner-all"><span class="ui-icon ui-icon-circle-triangle-e">Next</span></a>')):b==e.calendars?c.push(' ui-corner-right"><a title="Next" data-event="click" data-handler="next" class="ui-datepicker-next ui-corner-all"><span class="ui-icon ui-icon-circle-triangle-e">Next</span></a>'):c.push('">'),c.push('<div class="ui-datepicker-title">'),c.push(e._RenderSelectMonth(a)),c.push(e._RenderSelectYear(a)),c.push("</div>"),c.push("</div>"),c.push('<table class="ui-datepicker-calendar">'),c.push(e._RenderTitle()),c.push(e._RenderBody(d,f)),c.push("</table>"),c.push("</div>"),c.join("")},_RenderTitle:function(){var b,c,a=[];for(a.push("<tr>"),b=0;7>b;b++)c=7==b+d.firstDayOfWeek?7:(b+d.firstDayOfWeek)%7,a.push("<th>",e.weekDayNames[c],"</th>");return a.push("</tr>"),a.join("")},_RenderSelectMonth:function(a){var b,f,g;if(!d.changeMonth)return'<span class="ui-datepicker-month">'+e.monthName[a.getMonth()]+"</span>&nbsp;";for(b=[],new Date(d.maxDate),f=new Date(e.minDate),g=0,f.getFullYear()==a.getFullYear()&&(g=(new Date).getMonth()),b.push('<select class="sel_month ui-datepicker-month">'),i=g;12>i;i++)b.push("<option value='"+i+"'"),a.getMonth()==i&&b.push(" selected"),b.push(">"+e.monthsName[i]+"</option>");return b.push("</select>"),b.join("")},_RenderSelectYear:function(a){var b,c,f;if(!d.changeYear)return'<span class="ui-datepicker-year">'+a.getFullYear()+"</span>";for(b=[],c=new Date(d.maxDate),f=new Date(e.minDate),b.push('<select class="sel_year ui-datepicker-year">'),i=f.getFullYear();i<=c.getFullYear();i++)b.push("<option value='"+i+"'"),a.getFullYear()==i&&b.push(" selected"),b.push(">"+i+"</option>");return b.push("</select>"),b.join("")},_RenderBody:function(a,b){var k,l,m,c=new Date(b,a,1),f=c.getDay(),g=1,h=(7-d.firstDayOfWeek+f)%7,i=e._GetTotalDays(a,b);for(e._GetToalDaysOfPrevMonth(a,b),k=[],m=0;l=null,0==m%7&&k.push("<tr>"),k.push("<td"),m>=h&&i>=g?(l=new Date(b,a,g),0==Date.parse((new Date).toDateString())-l&&k.push(" class='ui-datepicker-today'"),g++):l=null,k.push(" day='",l,"'"),k.push(">"),k.push(e._BuildCell(l)),k.push("</td>"),6==m%7&&k.push("</tr>"),!(6==m%7&&g-1>=i);m++);return k.join("")},_hasEvnent:function(a){var b=a.getFullYear()+""+(a.getMonth()+1)+a.getDate();return e.data[b]},_BuildCell:function(a){var c,f,b=[];return a?(f=!1,d.data&&d.data[e.formatDate(a,"yyyyMMdd")]&&(c=d.data[e.formatDate(a,"yyyyMMdd")],f=!0),Date.parse(e.minDate)-a>0?b.push('<span class="ui-state-disabled">',a.getDate(),"<em>",c,"</em></span>"):(b.push('<a href="#" class="datepicker_day'),(0==Date.parse(d.currentDate)-a||f)&&b.push(' ui-state-active"'),b.push('">',a.getDate(),"<em>",c,"</em></a>"))):b.push("&nbsp;"),b.join("")},_GetTotalDays:function(a,b){return 1==a?e._IsLeapYear(b)?29:28:3==a||5==a||8==a||10==a?30:31},_GetToalDaysOfPrevMonth:function(a,b){return 0==a?(a=11,b-=1):a-=1,e._GetTotalDays(a,b)},_IsLeapYear:function(a){return 0==a%400||0==a%4&&0!=a%100},formatDate:function(a,b){var c=a,d=function(a,b){b||(b=2),a=String(a);for(var c=0,d="";c<b-a.length;c++)d+="0";return d+a};return b.replace(/(d{1,4}|M{1,4}|yy(?:yy)?|([hHmstT])\1?|[lLZ])/g,function(a){switch(a){case"d":return c.getDate();case"dd":return d(c.getDate());case"ddd":return["Sun","Mon","Tue","Wed","Thr","Fri","Sat"][c.getDay()];case"dddd":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][c.getDay()];case"M":return c.getMonth()+1;case"MM":return d(c.getMonth()+1);case"MMM":return e.monthsName[c.getMonth()];case"MMMM":return e.monthName[c.getMonth()];case"yy":return String(c.getFullYear()).substr(2);case"yyyy":return c.getFullYear();case"h":return c.getHours()%12||12;case"hh":return d(c.getHours()%12||12);case"H":return c.getHours();case"HH":return d(c.getHours());case"m":return c.getMinutes();case"mm":return d(c.getMinutes());case"s":return c.getSeconds();case"ss":return d(c.getSeconds());case"l":return d(c.getMilliseconds(),3);case"L":var b=c.getMilliseconds();return b>99&&(b=Math.round(b/10)),d(b);case"tt":return c.getHours()<12?"am":"pm";case"TT":return c.getHours()<12?"AM":"PM";case"Z":return c.toUTCString().match(/[A-Z]+$/);default:return a.substr(1,a.length-2)}})},getViewport:function(){var a="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(a?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(a?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(a?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(a?document.documentElement.clientHeight:document.body.clientHeight)}},show:function(){var b,c,f,g,h,i;d.onBeforeShow.apply(e,arguments),e.startDate<new Date(e.minDate)&&(e.startDate=new Date(e.minDate),e.setVal(e.startDate)),e._initCalendar(e.startDate),b=e.container,b.is(":visible")||(c=b.get(0),f=e.getViewport(),g=a(e).offset(),h=g.top+a(e).get(0).offsetHeight,i=g.left,b.css({visibility:"hidden",display:"block"}),h+c.offsetHeight>f.t+f.h&&(h=g.top-c.offsetHeight),h<f.t&&(h=g.top+a(e).get(0).offsetHeight),b.css({visibility:"visible",display:"block",top:h+"px",left:i+"px"}),b.show(),a(document).bind("mousedown",{cal:b,trigger:e},e.hide))},hide:function(b){b.target!=a(e).get(0)&&0==a(b.target).parents(".ui-datepicker").length&&(e.container.hide(),a(document).unbind("mousedown",e.hide))},setVal:function(b){d.currentDate=e.formatDate(b,d.dateFormat),a(e).val(d.currentDate),e.focus(),e.blur()},_InitEvent:function(){var b=e.startDate.getFullYear(),c=e.startDate.getMonth();e.formatDate(new Date(e.minDate),"yyyyMM")>=e.formatDate(e.startDate,"yyyyMM")&&a(".ui-datepicker-prev").addClass("ui-state-disabled"),e.formatDate(new Date(d.maxDate),"yyyyMM")<=e.formatDate(e.startDate,"yyyyMM")&&a(".ui-datepicker-next").addClass("ui-state-disabled"),a(".sel_month").bind("change",function(){var b=Math.floor(a(".sel_year",a(this).parent()).val()),c=Math.floor(a(this).val());e.startDate=new Date(b,c,1),a(this).unbind("change"),e.show()}),a(".sel_year").bind("change",function(){var b=Math.floor(a(this).val()),c=Math.floor(a(".sel_month",a(this).parent()).val());e.startDate=new Date(b,c,1),a(this).unbind("change"),e.show()}),a(".datepicker_day").bind("click",function(){var b=new Date(a(this).parent().attr("day"));return e.setVal(b),e.container.hide(),e.startDate=b,d.onSelect.apply(e,arguments),a(this).unbind("click"),!1}),a(".ui-datepicker-prev").bind("click",function(){a(this).hasClass("ui-state-disabled")||(0==c?(c=11,b--):c--,e.startDate=new Date(b,c,1),a(this).unbind("click"),e.show())}),a(".ui-datepicker-next").bind("click",function(){a(this).hasClass("ui-state-disabled")||(11==e.month?(c=0,b++):c++,e.startDate=new Date(b,c,1),a(this).unbind("click"),e.show())})}}),e.each(function(){e.render()})},a.fn.TcgCalendar.defaults={firstDayOfWeek:0,id:"tcgcalendar",currentDate:"",minDate:"1/1/1900",maxDate:"12/31/2050",calendars:2,eventName:"click",css:"",width:17,dateFormat:"MM/dd/yyyy",dataUrl:"json.js",data:null,changeMonth:!1,changeYear:!1,onBeforeShow:function(){return!0},onSelect:function(){return!0}}}(jQuery);